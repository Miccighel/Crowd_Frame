<!--
  LoaderComponent (no local ngx-ui-loader host).
  Uses the global host declared in BaseComponent via LOADER_ID='global'.
-->

<!-- Choice screen: Generate / Perform -->
@if (adminAccess && actionChosen === null) {
    <mat-grid-list cols="1" rowHeight="fit" id="selection-grid">
        <mat-grid-tile class="green-theme">
            <button
                id="generate-button"
                mat-raised-button
                color="primary"
                (click)="loadAction('generate')">
                <span i18n>Generate</span>
            </button>
        </mat-grid-tile>
        <mat-grid-tile>
            <button
                id="perform-button"
                mat-raised-button
                color="primary"
                (click)="loadAction('perform')">
                <span i18n>Perform</span>
            </button>
        </mat-grid-tile>
    </mat-grid-list>
}

<!-- Admin login for generator -->
@if (adminAccess && actionChosen === 'generate' && !loginSuccessful) {
    <div class="login-section green-theme">
        <form [formGroup]="loginForm" novalidate>
            <mat-card appearance="outlined">
                <mat-card-content>
                    <!-- Username -->
                    <mat-form-field>
                        <mat-label><span i18n>Insert your username</span></mat-label>
                        <input matInput type="text" placeholder="your_username" formControlName="username" autocomplete="username">
                        @if (checkFormControl(loginForm, 'username', 'required')) {
                            <mat-error><span i18n>This field is required</span></mat-error>
                        }
                    </mat-form-field>

                    <!-- Password -->
                    <mat-form-field>
                        <mat-label><span i18n>Insert your password</span></mat-label>
                        <input matInput type="password" placeholder="your_password" formControlName="password" autocomplete="current-password">
                        @if (checkFormControl(loginForm, 'password', 'required')) {
                            <mat-error><span i18n>This field is required</span></mat-error>
                        }
                    </mat-form-field>

                    <!-- Login feedback -->
                    @if (loginPerformed && !loginSuccessful) {
                        <mat-error><span i18n>Invalid credentials</span></mat-error>
                    }
                </mat-card-content>

                <mat-card-actions align="end">
                    <button id="start-button" mat-flat-button color="primary" type="button" (click)="performAdminCheck()">
                        <span i18n>Login</span>
                    </button>
                </mat-card-actions>
            </mat-card>
        </form>
    </div>
}

<!-- Generator shown only to authenticated admins -->
@if (adminAccess && loginSuccessful) {
    <app-generator></app-generator>
}

<!-- Non-admin or 'perform' action shows the skeleton runner -->
@if ((adminAccess && actionChosen === 'perform') || !adminAccess) {
    <app-skeleton></app-skeleton>
}
